# Program Director Configuration
# Go-based TV channel programmer for Tunarr
# Supports both CronJob (batch) and Deployment (server) modes

enabled: true

# Deployment mode: "cronjob" or "server"
mode: "cronjob"

image:
  repository: ghcr.io/geekxflood/program-director
  pullPolicy: Always
  tag: "latest"

# Debug logging
debug: false

# Database configuration
database:
  # Driver: "postgres" or "sqlite"
  driver: "sqlite"

  # PostgreSQL settings (if driver is "postgres")
  postgres:
    host: "postgres"
    port: 5432
    database: "program_director"
    user: "program_director"
    # Use existingSecret for password (recommended)
    existingSecret: ""
    existingSecretKey: "password"
    sslmode: "disable"

  # SQLite settings (if driver is "sqlite")
  sqlite:
    # Path inside the container
    path: "/app/data/program-director.db"

# Tunarr configuration (replaces ErsatzTV)
tunarr:
  url: "http://tunarr:8000"

# Ollama LLM configuration
ollama:
  url: "http://ollama:11434"
  model: "dolphin-llama3:8b"
  temperature: 0.7
  numCtx: 8192

# Radarr configuration (for movies)
radarr:
  url: "http://radarr:7878"
  # Secret containing API key (used when openbao.enabled=false)
  apiKeySecret: ""
  apiKeySecretKey: "api-key"

# Sonarr configuration (for TV shows/anime)
sonarr:
  url: "http://sonarr:8989"
  # Secret containing API key (used when openbao.enabled=false)
  apiKeySecret: ""
  apiKeySecretKey: "api-key"

# Cooldown settings (days before media can be replayed)
cooldown:
  movieDays: 30
  seriesDays: 14
  animeDays: 14

# HTTP Server settings (for "server" mode)
server:
  port: 8080
  enableScheduler: false
  metricsEnabled: true
  shutdownTimeout: 30

# Theme definitions for playlist generation
themes: []
# Example themes:
# themes:
#   - name: "sci-fi-night"
#     description: "Evening programming featuring science fiction content"
#     channelId: "your-tunarr-channel-id"
#     schedule: "0 20 * * *"  # 8 PM daily (for scheduler mode)
#     mediaTypes:
#       - "movie"
#       - "series"
#     genres:
#       - "Science Fiction"
#       - "Sci-Fi"
#     keywords:
#       - "space"
#       - "future"
#       - "robot"
#     minRating: 6.0
#     maxItems: 10
#     duration: 300
#
#   - name: "horror-weekend"
#     description: "Weekend horror movie marathon"
#     channelId: "another-channel-id"
#     schedule: "0 21 * * 5-6"  # 9 PM Friday-Saturday
#     mediaTypes:
#       - "movie"
#     genres:
#       - "Horror"
#       - "Thriller"
#     keywords:
#       - "scary"
#     minRating: 5.0
#     maxItems: 5
#     duration: 600

# API Keys secret (legacy mode - use openbao instead)
apiKeys:
  createSecret: false
  radarrApiKey: ""
  sonarrApiKey: ""

# OpenBao (Vault) integration for secrets management
openbao:
  enabled: false

  # Reference to VaultConnection resource (namespace/name format)
  vaultConnectionRef: "vault-secrets-operator-system/default"

  # VaultAuth configuration for Kubernetes authentication
  vaultAuth:
    create: true
    mount: "kubernetes"
    role: "media"
    tokenExpirationSeconds: 600

  # Radarr API key secret from OpenBao
  radarrSecret:
    enabled: true
    mount: "secret"
    path: "media/radarr"
    secretName: ""  # Defaults to <fullname>-radarr-secret
    secretKey: "api-key"
    refreshAfter: "1h"

  # Sonarr API key secret from OpenBao
  sonarrSecret:
    enabled: true
    mount: "secret"
    path: "media/sonarr"
    secretName: ""  # Defaults to <fullname>-sonarr-secret
    secretKey: "api-key"
    refreshAfter: "1h"

  # PostgreSQL password from OpenBao (optional)
  postgresSecret:
    enabled: false
    mount: "secret"
    path: "media/program-director/postgres"
    secretName: ""  # Defaults to <fullname>-postgres-secret
    secretKey: "password"
    refreshAfter: "1h"

# Scheduling (for CronJob mode)
schedule:
  enabled: true
  # Default: Run daily at 6 PM
  cron: "0 18 * * *"

# Persistence (for SQLite and data)
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 1Gi
  # Bind to existing PV
  volumeName: ""

# Ingress (for server mode)
ingress:
  enabled: false
  className: "cilium"
  annotations: {}
  hosts:
    - host: program-director.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Service (for server mode)
service:
  type: ClusterIP
  port: 8080

# Resources
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# Service account
serviceAccount:
  create: true
  name: ""

# Pod annotations
podAnnotations: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
