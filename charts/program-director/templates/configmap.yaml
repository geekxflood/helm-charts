apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "program-director.fullname" . }}-config
  labels:
    {{- include "program-director.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Debug logging
    debug: {{ .Values.debug }}

    # Database configuration
    database:
      driver: {{ .Values.database.driver | quote }}
      {{- if eq .Values.database.driver "postgres" }}
      postgres:
        host: {{ .Values.database.postgres.host | quote }}
        port: {{ .Values.database.postgres.port }}
        database: {{ .Values.database.postgres.database | quote }}
        user: {{ .Values.database.postgres.user | quote }}
        # Password injected via environment variable
        sslmode: {{ .Values.database.postgres.sslmode | quote }}
      {{- end }}
      {{- if eq .Values.database.driver "sqlite" }}
      sqlite:
        path: {{ .Values.database.sqlite.path | quote }}
      {{- end }}

    # Tunarr configuration
    tunarr:
      url: {{ .Values.tunarr.url | quote }}

    # Ollama LLM configuration
    ollama:
      url: {{ .Values.ollama.url | quote }}
      model: {{ .Values.ollama.model | quote }}
      temperature: {{ .Values.ollama.temperature }}
      num_ctx: {{ .Values.ollama.numCtx }}

    # Radarr configuration
    radarr:
      url: {{ .Values.radarr.url | quote }}
      # API key injected via environment variable

    # Sonarr configuration
    sonarr:
      url: {{ .Values.sonarr.url | quote }}
      # API key injected via environment variable

    # Cooldown settings
    cooldown:
      movie_days: {{ .Values.cooldown.movieDays }}
      series_days: {{ .Values.cooldown.seriesDays }}
      anime_days: {{ .Values.cooldown.animeDays }}

    # Server settings (for server mode)
    server:
      port: {{ .Values.server.port }}
      enable_scheduler: {{ .Values.server.enableScheduler }}
      metrics_enabled: {{ .Values.server.metricsEnabled }}
      shutdown_timeout: {{ .Values.server.shutdownTimeout }}

    # Theme definitions
    themes:
      {{- toYaml .Values.themes | nindent 6 }}
