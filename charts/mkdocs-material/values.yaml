# Default values for mkdocs-material
# This chart deploys a mkdocs-material documentation site with git-sync for automatic updates

replicaCount: 1

# MkDocs Material container configuration
image:
  repository: squidfunk/mkdocs-material
  pullPolicy: Always
  tag: "9.7.0"

# Git sync sidecar configuration
# This sidecar pulls the wiki content from a git repository
gitSync:
  enabled: true
  image:
    repository: registry.k8s.io/git-sync/git-sync
    tag: v4.5.1
    pullPolicy: IfNotPresent

  # Git repository containing mkdocs content
  # MUST be configured for the wiki to work
  repo: ""  # e.g., https://github.com/user/docs.git or git@github.com:user/docs.git
  branch: main
  depth: 1  # Shallow clone for faster sync
  period: 60s  # Sync interval (60 seconds)

  # Subdirectory path within the repository (optional)
  # If the mkdocs content is in a subdirectory, specify it here
  # Example: "wiki" for repo/wiki/mkdocs.yml
  subPath: ""

  # For private repositories using SSH
  ssh:
    enabled: false
    # Secret containing SSH private key (key name: ssh)
    secretName: ""

  # For private repositories using HTTPS with token
  https:
    enabled: false
    # Secret containing git credentials (keys: username, password/token)
    secretName: ""

# ServiceAccount configuration
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Pod annotations
# Note: MkDocs logs to stdout, so Kyverno log-tailer is not needed
podAnnotations: {}

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# Service configuration
service:
  type: ClusterIP
  port: 8000

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-production
  hosts:
    - host: wiki.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: mkdocs-material-tls
    #   hosts:
    #     - wiki.example.com

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Liveness probe
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe
readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Persistent volume for docs content (synced from git)
persistence:
  enabled: true
  storageClass: ""  # Use default storage class
  accessMode: ReadWriteOnce
  size: 5Gi
  # Existing claim name (optional)
  existingClaim: ""

# Additional volumes
extraVolumes:
  - name: tmp
    emptyDir: {}

# Additional volume mounts
extraVolumeMounts:
  - name: tmp
    mountPath: /tmp

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Extra environment variables
env:
  - name: TZ
    value: UTC

# MkDocs serve options
mkdocs:
  # Dev server address (0.0.0.0 to bind to all interfaces)
  devAddr: "0.0.0.0:8000"
  # Enable live reload (useful with git-sync)
  liveReload: true
  # Strict mode (fail on warnings)
  strict: false

# MkDocs plugins configuration
# Plugins are installed via init containers to avoid custom Docker images
plugins:
  # Draw.io diagram embedding support
  drawio:
    enabled: false  # Set to true to enable Draw.io support
    version: "1.11.2"  # mkdocs-drawio plugin version
